<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="keywords"
          content="admin, dashboard, bootstrap, template, flat, modern, theme, responsive, fluid, retina, backend, html5, css, css3">
    <meta name="description" content="股票金融风险预测平台">
    <meta name="author" content="ThemeBucket">
    <link rel="shortcut icon" href="../static/images/invoice-logo.jpg"
          th:href="@{images/invoice-logo.jpg}" type="image/png">
    <title>股票金融风险预测平台</title>

    <link rel="shortcut icon" href="../static/images/invoice-logo.jpg"
          th:href="@{images/invoice-logo.jpg}" type="image/png">
    <title>股票金融风险预测平台</title>

    <!--pickers css-->
    <link rel="stylesheet" type="text/css" th:href="@{plugins/bootstrap-datepicker/css/datepicker-custom.css}"/>

    <!--slider css-->
    <link href="../static/css/jquery-ui-1.10.3.css" th:href="@{css/jquery-ui-1.10.3.css}"/>
    <!--dynamic table-->
    <link href="../static/plugins/advanced-datatable/css/demo_page.css"  th:href="@{plugins/advanced-datatable/css/demo_page.css}"  rel="stylesheet"/>
    <link href="../static/plugins/advanced-datatable/css/demo_table.css" th:href="@{plugins/advanced-datatable/css/demo_table.css}" rel="stylesheet"/>
    <link href="../static/plugins/data-tables/DT_bootstrap.css" th:href="@{plugins/data-tables/DT_bootstrap.css}"/>

    <!--common-->
    <link href="../static/css/style.css" th:href="@{css/style.css}" rel="stylesheet">
    <link href="../static/css/style-responsive.css" th:href="@{css/style-responsive.css}" rel="stylesheet">
    <link href="../static/css/mystyle.css" th:href="@{css/mystyle.css}" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script th:src="@{js/html5shiv.js}"></script>
    <script th:src="@{js/respond.min.js}"></script>
    <![endif]-->
    <!--##################################3##########################################-->
    <!--pickers css-->
    <link rel="stylesheet" type="text/css" href="../static/plugins/bootstrap-datepicker/css/datepicker-custom.css"/>


</head>

<body class="sticky-header">
<section>
    <!-- left side start-->
    <div class="left-side sticky-left-side"  th:include="left_side_template :: leftside"></div>
    <!-- left side end-->

    <!-- main content start-->
    <div class="main-content">

        <!-- header section start-->
        <div class="header-section" style="border-bottom: rgba(0,0,0,0.39) solid 1px;">
            <!--toggle button start-->
            <a class="toggle-btn"><i class="fa fa-bars"></i></a>
            <!--toggle button end-->
            <!--title start-->
            <div style="width: 80%;margin-top: 15px;text-align: center;">
                <span style="font-size:30px;margin-left: 200px;">股票金融风险预测平台</span>
                <div id="click" style="float:right;"></div>
            </div>
            <!--title end-->
        </div>
        <!-- header section end-->

        <!--body wrapper start-->
        <div class="wrapper">

            <!--预测参数 start-->
            <div class="row">
                <div class="col-md-12">
                    <!--param setting start-->
                    <section class="panel">
                        <header class="panel-heading">
                            预测参数设置
                            <span class="tools pull-right">
                                <a class="fa fa-chevron-down" href="javascript:;"></a>
                            </span>
                        </header>
                        <div class="panel-body">
                            <div class="panel-body">
                                <div class="col-md-7">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="row">
                                                <div class="col-md-5"
                                                     style="position: relative;transform: translateY(20%);text-align: right;">
                                                    <label>股票数量:</label>
                                                </div>
                                                <div class="col-md-7">
                                                    <input th:value="${stock_size}" type="text" id="amount" class="form-control">
                                                    <div id="slider-range-max"></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="row">
                                                <div class="col-md-5"
                                                     style="position: relative;transform: translateY(20%);text-align: right;">
                                                    <label>起始日期:</label>
                                                </div>
                                                <div class="col-md-7">
                                                    <input th:value="${start_date}" class="form-control default-date-picker" size="16"
                                                           type="text" value="" readonly/>
                                                </div>
                                            </div>
                                            <div class="row next_param">
                                                <div class="col-md-5"
                                                     style="position: relative;transform: translateY(20%);text-align: right;">
                                                    <label>结束日期:</label>
                                                </div>
                                                <div class="col-md-7">
                                                    <input class="form-control default-date-picker" size="16"
                                                           type="text" th:value="${end_date}" readonly/>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="row">
                                                <div class="col-md-5">
                                                    <label>聚类族数:</label>
                                                </div>
                                                <div class="col-md-7">
                                                    <input type="text" class="form-control"
                                                           placeholder="150"
                                                           th:value="${cluster_size}">
                                                </div>
                                            </div>
                                            <div class="row next_param">
                                                <div class="col-md-5">
                                                    <label>预测天数:</label>
                                                </div>
                                                <div class="col-md-7">
                                                    <input type="text" class="form-control"
                                                           placeholder="100"
                                                           th:value="${predict_dates}">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-5" style="margin-top: 20px;">
                                    <button id="bt-beginPre" class="btn btn-primary btn-lg" type="button">开始预测</button>
                                </div>
                            </div>
                        </div>
                    </section>
                    <!--param setting end-->
                </div>
            </div>
            <!--预测参数 end-->

            <!--Striped Progress Bars start-->
            <div id="progress-bar" class="row">
                <div class="col-md-3"></div>
                <div class="col-md-6" style="text-align: center;">
                    <div id="bar-text">正在<span >加载数据</span></div>
                    <div class="progress progress-striped active"style="background-color: rgba(0,0,0,0.44);">
                        <div id="prog" class="progress-bar" role="progressbar" aria-valuenow="" aria-valuemin="0" aria-valuemax="100"
                             style="width:0%;">
                            <span id="proglabel">正在启动，请稍后......</span>
                        </div>
                    </div>
                </div>
                <div class="col-md-3"></div>
            </div>
            <!--Striped Progress Bars end-->
            <!--最优组合结果 start-->
            <div id="best-result" class="row">
                <div class="col-md-4">
                    <!--more statistics box start-->
                    <div id="best-result-left" class="panel" style="background-color: rgba(0,0,0,0.45);height: 530px;">
                        <div class="panel-body" >
                            <p style="padding-left:5px;color: #ffffff;font-size: 16px;">最优组合结果</p>
                            <section class="panel">
                                <div class="panel-body stockListPanel">
                                    <table id="best-result-table" class="table table-hover">
                                        <thead>
                                        <tr>
                                            <th><span class="label label-info label-mini"></span></th>
                                            <th>聚类类别</th>
                                            <th>股票代码</th>
                                            <th>股票名称</th>
                                        </tr>
                                        </thead>
                                        <tbody id="tbzuhe">
                                        <!--<tr th:each="zuhe,iterStat:${zuheList}"-->
                                            <!--th:id="${zuhe.name}">-->
                                            <!--<td></td>-->
                                            <!--<td th:text="|第${zuhe.classId}聚类|">第i类</td>-->
                                            <!--<td th:text="${zuhe.id}">第i类</td>-->
                                            <!--<td th:text="${zuhe.name}">第i类</td>-->
                                        <!--</tr>-->
                                        </tbody>
                                    </table>
                                </div>
                            </section>

                            <div id="echart-piecchart"
                                 style="min-width:200px;height:200px;margin-top: 20px;" ></div>

                        </div>
                    </div>
                    <!--more statistics box end-->
                </div>
                <div class="col-md-8">
                    <div id="best-result-right" class="panel" style="background-color: rgba(0,0,0,0.45);">
                        <div class="panel-body">
                            <div id="echarts-div" style="min-width:420px;height:500px;"></div>
                        </div>
                    </div>
                </div>
            </div>
            <!--最优组合结果 end-->

            <!--所有股票聚类结果 start-->
            <div id="all-result" class="row">
                <div class="col-md-4">
                    <div class="row">
                        <div class="col-sm-12">
                            <section class="panel">
                                <header class="panel-heading">
                                    所有聚类结果
                                    <span class="tools pull-right">
                <a href="javascript:;" class="fa fa-chevron-down"></a>
             </span>
                                </header>
                                <div class="panel-body">
                                    <div class="adv-table">
                                        <table class="display table table-bordered table-striped" id="dynamic-table">
                                            <thead>
                                            <tr>
                                                <th>聚类类别</th>
                                                <th>股票代码</th>
                                                <th>股票名称</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            <tr th:each="zuhe,iterStock:${clusterZuheList}"
                                                th:id="${zuhe.id}">
                                                <td th:text="|第${zuhe.classId}聚类|">第i类</td>
                                                <td th:text="${zuhe.id}">代码</td>
                                                <td th:text="${zuhe.name}">名称</td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </div>
                </div>
                <div class="col-md-8">
                    <div class="panel">
                        <div class="panel">
                            <div class="panel-body">
                                <div id="echarts-div2" style="min-width:500px;height:500px;"></div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <!--所有股票聚类结果 end-->
        </div>
        <!--body wrapper end-->
        <!--footer section start-->
        <footer th:include="footer_template :: myfooter"></footer>
        <!--footer section end-->
    </div>
    <!-- main content end-->
</section>

<!-- Placed js at the end of the document so the pages load faster -->
<script src="../static/js/jquery-1.10.2.min.js" th:src="@{js/jquery-1.10.2.min.js}"></script>
<script src="../static/js/jquery-ui-1.9.2.custom.min.js" th:src="@{js/jquery-ui-1.9.2.custom.min.js}"></script>
<script src="../static/js/jquery-migrate-1.2.1.min.js" th:src="@{js/jquery-migrate-1.2.1.min.js}"></script>
<script src="../static/js/bootstrap.min.js" th:src="@{js/bootstrap.min.js}"></script>
<!--<script src="js/js/modernizr.min.js"></script>-->
<script src="../static/js/bootstrap.min.js" th:src="@{js/jquery.nicescroll.js}"></script>

<!--common scripts for all pages-->
<script src="../static/js/scripts.js"  th:src="@{js/scripts.js}"></script>
<!--pickers plugins-->
<script src="../static/plugins/bootstrap-datepicker/js/bootstrap-datepicker.js"  th:src="@{plugins/bootstrap-datepicker/js/bootstrap-datepicker.js}"></script>
<!--pickers initialization-->
<script src="../static/js/pickers-init.js" th:src="@{js/pickers-init.js}"></script>

<!--slider initialization-->
<script src="../static/js/myjsfile.js" th:src="@{js/myjsfile.js}"></script>

<!--dynamic table-->
<script src="../static/plugins/advanced-datatable/js/jquery.dataTables.js" th:src="@{plugins/advanced-datatable/js/jquery.dataTables.js}"></script>
<script src="../static/plugins/data-tables/DT_bootstrap.js" th:src="@{plugins/data-tables/DT_bootstrap.js}"></script>
<!--dynamic table initialization -->
<script src="../static/plugins/advanced-datatable/dynamic_table_init.js" th:src="@{plugins/advanced-datatable/dynamic_table_init.js}"></script>

<!-- echarts stock-->
<script src="../static/js/echarts/echarts.min.js" th:src="@{js/echarts/echarts.min.js}"></script>
<script src="../static/js/echarts/dark.js" th:src="@{js/echarts/dark.js}"></script>
<script src="../static/js/echarts/echarts-init.js" th:src="@{js/echarts/echarts-init.js}"></script>


<!--slider initialization-->
<!--<script th:inline="javascript" src="../static/js/inline_js.js" th:src="@{js/inline_js.js}"></script>-->
<script th:inline="javascript">
    /*<![CDATA[*/
    var size = /*[[${stock_size}]]*/ 2;
    var all_stock_size = /*[[${all_stock_size}]]*/ 100;
    //alert("size is "+size);
    setStockSize(all_stock_size,size);

    /*]]>*/
</script>

<script th:inline="javascript">
    /*<![CDATA[*/
    // 最优组合的echart 初始化echarts实例
    var zuheList = /*[[${zuheList}]]*/ 2;
    //alert(zuheList[0].id+":"+zuheList[0].name);
    var myChart = echarts.init(document.getElementById('echarts-div'),"dark");
    //    var xdata = ["2017/12/18","2017/12/20","2018/1/2",
    //        "2018/1/5","2018/1/8","2018/1/10","2018/1/22","2018/1/22","2018/1/23","2018/1/26","2018/1/28"];
    //var bestchartdata =[[5, 20, 36, 10, 10, 20], [-5, 50, 26, 20, -10, 50]];
    var xdata = /*[[${xdata}]]*/ 2;
    var model = /*[[${model}]]*/ 2;
    var urlStr = "/getStockDataByModelAndStock?modelName="+model+"&stockName="+zuheList[0].name;

    function setBestResultChart(urlStr) {

        $.get(urlStr,function(data,status){
            //alert("数据: " + data + "\n状态: " + status);
            var bestdata = getDataTransfer(data);
            setBestChart(myChart,bestdata,xdata,zuheList[0].id+":"+zuheList[0].name);

        });

        for (var i =0; i<zuheList.length; i++){
            (function(){
                var zuhe = zuheList[i];
                $("#"+zuhe.name).click(function(){
                    // 动作触发后执行的代码!!
                    var urlStr2 = "/getStockDataByModelAndStock?modelName="+model+"&stockName="+zuhe.name;
                    $.get(urlStr2,function(data,status){
                        //alert("数据: " + data + "\n状态: " + status);
                        var bestdata = getDataTransfer(data);
                        setBestChart(myChart,bestdata,xdata,zuhe.id+":"+zuhe.name);

                    });
                });
            })();
        }
    }

    function setBestResultTable(zuheList) {
        $("#tbzuhe").empty();
        for (var i =0; i<zuheList.length; i++){
            var str = "<tr id="+zuheList[i].name
                +"> <td></td>"
                + "<td>第"+zuheList[i].classId +"聚类</td>"
                + "<td>"+zuheList[i].id+"</td>"
                + "<td>"+zuheList[i].name+"</td>"
                + "</tr>";
            $("#tbzuhe").append(str);
        }
        //设置table和聚类饼图的相应颜色对应
        setBestResultColor();
    }

    /*所有聚类的图表 start*/
    var clusterZuheList = /*[[${clusterZuheList}]]*/ 2;
    var myChart2 = echarts.init(document.getElementById('echarts-div2'));

    //因为所有股票列表自动排列的原因，此处显示最后一支股票
    var allZuhe = clusterZuheList[0];
    urlStr = "/getStockDataByModelAndStock?modelName="+model
        +"&stockName="+allZuhe.name;

    $.get(urlStr,function(data,status){
        //alert("数据: " + data + "\n状态: " + status);
        var bestdata = getDataTransfer(data);
        setBestChart(myChart2,bestdata,xdata,allZuhe.id+":"+allZuhe.name);

    });

    for (var i =0; i<clusterZuheList.length; i++){
        (function(){
            var zuhe = clusterZuheList[i];
            $("#"+zuhe.id).click(function(){
                // 动作触发后执行的代码!!
                var urlStr = "/getStockDataByModelAndStock?modelName="+model+"&stockName="+zuhe.name;
                $.get(urlStr,function(data,status){
                    //alert("数据: " + data + "\n状态: " + status);
                    var bestdata = getDataTransfer(data);
                    setBestChart(myChart2,bestdata,xdata,zuhe.id+":"+zuhe.name);
                });
            });
        })();
    }
    /*]]>*/
</script>
<script th:inline="javascript">
    /*<![CDATA[*/
    var piePartList = /*[[${pieChartsParamList}]]*/ 2;
    //alert(piePartList);
    var piechartdata =[];
    for (var i=0;i<piePartList.length;i++){
        var temp = {value:piePartList[i].value,name:piePartList[i].partName};
        piechartdata[i] = temp;
    }
    /*最优组合的图表 piecahrt start*/
    //    var data = [
    //        {value:335, name:'第一聚类'},
    //        {value:310, name:'第二聚类'}
    //    ];
    /*]]>*/
    //setPieChart(piechartdata);
</script>

<script type="text/javascript">
    function hiddenAll() {
        //先隐藏进度条
        var progress=document.getElementById("progress-bar");
        progress.style.display='none';

//        //先隐藏进度条
//        var best_result=document.getElementById("best-result");
//        best_result.style.display='none';
        //先隐藏进度条
        var best_result_left=document.getElementById("best-result-left");
        best_result_left.style.display='none';
        //先隐藏进度条
        var best_result_right=document.getElementById("best-result-right");
        best_result_right.style.display='none';

        //先隐藏进度条
        var all_result=document.getElementById("all-result");
        all_result.style.display='none';

    }
    hiddenAll();

    function showSomeById(id) {
        var some=document.getElementById(id);
        some.style.display='block';
    }
    $(document).ready(function () {
        var value = 0;
        var time = 100;
        //进度条复位函数
        function reset() {
            value = 0;
            $("#prog").removeClass("progress-bar-success").css("width", "0%").text("等待启动");
            //隐藏进度条
            var progress=document.getElementById("progress-bar");
            progress.style.display='none';
        }
        var bar_text=document.getElementById("bar-text");
        var textArr=["正在<span>初始化预测环境</span>","正在<span >加载数据</span>",
            "正在<span >训练模型</span>","正在<span >预测计算</span>","正在<span >完成</span>"]
        //百分数增加，0-30时为红色，30-60为黄色，60-90为蓝色，>90为绿色
        function increment() {
            value += 1;
            $("#prog").css("width", value + "%").text(value + "%");
            if (value >= 0 && value <= 20) {
                bar_text.innerHTML=textArr[0];
                $("#prog").addClass("progress-bar-danger");
            }
            else if (value >= 20 && value <= 30) {
                bar_text.innerHTML=textArr[1];
                $("#prog").removeClass("progress-bar-danger");
                $("#prog").addClass("progress-bar-warning");
            }
            else if (value >= 30 && value <= 75) {
                bar_text.innerHTML=textArr[2];
                $("#prog").removeClass("progress-bar-warning");
                $("#prog").addClass("progress-bar-info");
            }
            else if (value >= 75 && value < 100) {
                bar_text.innerHTML=textArr[3];
                $("#prog").removeClass("progress-bar-info");
                $("#prog").addClass("progress-bar-success");
            }
            else {
                bar_text.innerHTML=textArr[4];
                setTimeout(reset, 3000);

                setTimeout(showSomeById("best-result-left"), 1000);
                setTimeout(setBestResultTable(zuheList), 2000);
                setTimeout(setPieChart(piechartdata), 3000);

                setTimeout(showSomeById("best-result-right"), 5000);
                setTimeout(setBestResultChart(urlStr), 6000);
                setTimeout(showSomeById("all-result"), 8000);
                return;
            }
            st = setTimeout(increment, time);
        }
        //进度条开始
        //开始预测按钮点击事件
        $("#bt-beginPre").click(function () {
            hiddenAll();
            var progress=document.getElementById("progress-bar");
            progress.style.display='block';
            increment();
        });
        
    });
</script>
<script >
    //样式设置
    $("#index-page").addClass("active")
</script>
</body>
</html>
